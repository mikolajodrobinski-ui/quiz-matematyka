<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Panel nauczyciela â€“ wyniki quizu</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <main class="quiz-container">
    <a href="index.html">
      <button style="margin-bottom: 20px;">â¬…ï¸ WrÃ³Ä‡ do menu</button>
    </a>

    <h1>ğŸ“Š Panel nauczyciela â€“ wyniki quizu</h1>

    <div id="access-denied" class="error-message" style="display:none;">âŒ DostÄ™p zabroniony â€“ nieprawidÅ‚owe hasÅ‚o.</div>

    <table id="results-table" class="results-table" style="display:none;">
      <thead>
        <tr>
          <th>ID</th>
          <th>ImiÄ™</th>
          <th>Wynik</th>
          <th>BÅ‚Ä™dy</th>
          <th>Czas</th>
          <th>Data</th>
          <th>Akcja</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <button onclick="wyloguj()" style="margin-top: 20px;">ğŸšª Wyloguj</button>
  </main>

  <script>
    // Sprawdzenie dostÄ™pu na podstawie localStorage
    const dostep = localStorage.getItem("dostepNauczyciel");
    if (dostep === "true") {
      document.getElementById("results-table").style.display = "table";
      fetch('/wyniki')
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector('#results-table tbody');
          data.forEach(entry => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${entry.id}</td>
              <td>${entry.imie}</td>
              <td>${entry.wynik}</td>
              <td><pre>${entry.bledy}</pre></td>
              <td>${entry.czas || '-'}</td>
              <td>${new Date(entry.data).toLocaleString()}</td>
              <td><button class="usun-button" onclick="usunWpis(${entry.id})">UsuÅ„</button></td>
            `;
            tbody.appendChild(row);
          });
        });
    } else {
      document.getElementById("access-denied").style.display = "block";
    }

    function usunWpis(id) {
      if (confirm("Czy na pewno chcesz usunÄ…Ä‡ wpis ID " + id + "?")) {
        fetch('/usun-wynik/' + id, { method: 'DELETE' })
          .then(res => res.text())
          .then(msg => {
            alert(msg);
            location.reload();
          })
          .catch(err => {
            console.error("âŒ BÅ‚Ä…d usuwania:", err);
            alert("âŒ Nie udaÅ‚o siÄ™ usunÄ…Ä‡ wpisu.");
          });
      }
    }

    function wyloguj() {
      localStorage.removeItem("dostepNauczyciel");
      location.href = "index.html";
    }
  </script>
</body>
</html>
