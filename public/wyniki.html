<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Panel nauczyciela â€“ wyniki quizu</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    /* Ukryj kolumnÄ™ ID, ale zostaw jÄ… w DOM dla backendu */
    .results-table th.id-col,
    .results-table td.id-col {
      display: none;
    }
    /* Czytelna lista bÅ‚Ä™dÃ³w w komÃ³rce */
    .bledy-list {
      margin: 0;
      padding-left: 18px; /* odstÄ™p dla listy */
    }
    .bledy-list li {
      margin-bottom: 4px;
      white-space: normal; /* pozwÃ³l Å‚amaÄ‡ linie */
      word-wrap: break-word;
    }
  </style>
  <!-- MathJax do renderowania LaTeX w bÅ‚Ä™dach -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(', '\\)'], ['$', '$']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
  <main class="quiz-container">
    <!-- Przycisk na gÃ³rze -->
    <button class="menu-button" onclick="location.href='index.html'" style="margin-top: 20px;">â¬…ï¸ WrÃ³Ä‡ do menu</button>

    <h1>ğŸ“Š Panel nauczyciela â€“ wyniki quizu</h1>

    <div id="access-denied" class="error-message" style="display:none;">
      âŒ DostÄ™p zabroniony â€“ nieprawidÅ‚owe hasÅ‚o.
    </div>

    <!-- Kontener dla responsywnej tabeli -->
    <div class="table-container" style="display:none;" id="results-wrapper">
      <table id="results-table" class="results-table">
        <thead>
          <tr>
            <th class="id-col">ID</th>
            <th>ImiÄ™</th>
            <th>Wynik</th>
            <th>BÅ‚Ä™dy</th>
            <th>Czas</th>
            <th>Data</th>
            <!-- <th>Akcja</th> -->
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>

  <script>
    const dostep = localStorage.getItem("dostepNauczyciel");

    function formatErrors(text) {
      if (!text) return '<em>Brak</em>';
      // Rozbij po Å›redniku, usuÅ„ puste elementy, przytnij spacje
      const items = text
        .split(';')
        .map(s => s.trim())
        .filter(s => s.length > 0);
      if (items.length === 0) return '<em>Brak</em>';
      // Zbuduj listÄ™ HTML
      const html = '<ul class="bledy-list">' +
        items.map(item => `<li>${item}</li>`).join('') +
        '</ul>';
      return html;
    }

    if (dostep === "true") {
      document.getElementById("results-wrapper").style.display = "block";
      fetch('/wyniki')
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector('#results-table tbody');
          tbody.innerHTML = '';
          data.forEach(entry => {
            const row = document.createElement('tr');
            const bledyHTML = formatErrors(entry.bledy);
            row.innerHTML = `
              <td class="id-col">${entry.id ?? ''}</td>
              <td>${entry.imie ?? '-'}</td>
              <td>${entry.wynik ?? '-'}</td>
              <td>${bledyHTML}</td>
              <td>${entry.czas || '-'}</td>
              <td>${entry.data ? new Date(entry.data).toLocaleString() : '-'}</td>
              <!-- <td><button class="usun-button" onclick="usunWpis(${entry.id})">UsuÅ„</button></td> -->
            `;
            tbody.appendChild(row);
          });
          // Render LaTeX w bÅ‚Ä™dach po wstawieniu do DOM
          if (window.MathJax && window.MathJax.typesetPromise) {
            MathJax.typesetPromise();
          }
        })
        .catch(err => {
          console.error("âŒ BÅ‚Ä…d pobierania wynikÃ³w:", err);
          alert("âŒ Nie udaÅ‚o siÄ™ pobraÄ‡ wynikÃ³w.");
        });
    } else {
      document.getElementById("access-denied").style.display = "block";
    }

    // Funkcja usuwania zostaje w kodzie, ale nie jest uÅ¼ywana
    /*
    function usunWpis(id) {
      if (confirm("Czy na pewno chcesz usunÄ…Ä‡ wpis ID " + id + "?")) {
        fetch('/usun-wynik/' + id, { method: 'DELETE' })
          .then(res => res.text())
          .then(msg => {
            alert(msg);
            location.reload();
          })
          .catch(err => {
            console.error("âŒ BÅ‚Ä…d usuwania:", err);
            alert("âŒ Nie udaÅ‚o siÄ™ usunÄ…Ä‡ wpisu.");
          });
      }
    }
    */
  </script>
</body>
</html>
