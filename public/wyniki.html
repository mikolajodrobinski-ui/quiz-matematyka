<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Panel nauczyciela – wyniki quizu</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <main class="quiz-container">
    <a href="index.html">
      <button style="margin-bottom: 20px;">⬅️ Wróć do menu</button>
    </a>

    <h1>📊 Panel nauczyciela – wyniki quizu</h1>

    <div id="access-denied" class="error-message" style="display:none;">❌ Dostęp zabroniony – nieprawidłowe hasło.</div>

    <table id="results-table" class="results-table" style="display:none;">
      <thead>
        <tr>
          <th>ID</th>
          <th>Imię</th>
          <th>Wynik</th>
          <th>Błędy</th>
          <th>Czas</th>
          <th>Data</th>
          <th>Akcja</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

  <script>
    const haslo = prompt("🔐 Podaj hasło nauczyciela:");
    if (haslo === "notsecret") {
      document.getElementById("results-table").style.display = "table";
      fetch('/wyniki')
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector('#results-table tbody');
          data.forEach(entry => {
            const row = document.createElement('tr');
            row.innerHTML = `
            <td>${entry.id}</td>
            <td>${entry.imie}</td>
            <td>${entry.wynik}</td>
            <td><pre>${entry.bledy}</pre></td>
            <td>${entry.czas || '-'}</td>
            <td>${new Date(entry.data).toLocaleString()}</td>
            <td><button class="usun-button" onclick="usunWpis(${entry.id})">Usuń</button></td>
  `;

            tbody.appendChild(row);
          });
        });
    } else {
      document.getElementById("access-denied").style.display = "block";
    }

    function usunWpis(id) {
      if (confirm("Czy na pewno chcesz usunąć wpis ID " + id + "?")) {
        fetch('/usun-wynik/' + id, { method: 'DELETE' })
          .then(res => res.text())
          .then(msg => {
            alert(msg);
            location.reload();
          })
          .catch(err => {
            console.error("❌ Błąd usuwania:", err);
            alert("❌ Nie udało się usunąć wpisu.");
          });
      }
    }
  </script>
</body>
</html>
